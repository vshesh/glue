<!DOCTYPE html>
<html>
<head>
  <style>
    .pictogram {
      position: relative;
    }
    .pictogram > img {
      height: 1.5em;
      vertical-align: middle;
    }
    .pictogram > span.pictoword {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0,0,0,0.4);
      color: white;
      display: none;
      font-size: 75%;
    }
    .pictogram:hover > .pictoword {
      display: inline;
    }
  </style>

  <script>
  function getStyleProp(elem, prop){
    if(window.getComputedStyle)
        return window.getComputedStyle(elem, null).getPropertyValue(prop);
    else if(elem.currentStyle) return elem.currentStyle[prop]; //IE
  }

  function setViewBox(selector) {
    var el = document.getElementById(selector);

    var height = parseFloat(getStyleProp(el, 'height'));
    var width = parseFloat(getStyleProp(el, 'width'));
    el.removeAttribute('style');
    var svg = el.firstChild;
    svg.setAttribute("viewBox", "0 0 " + width + " " + height);
    svg.removeAttribute("height");
    svg.removeAttribute("width");
  }
  </script>
  <script src="https://rawgit.com/paulrosen/abcjs/master/bin/abcjs_basic_midi_3.0-min.js"></script>

  <style>
    svg.chordChart g.grid {stroke: black; stroke-width: 1px;}
    svg.chordChart text.labels {fill: white;}
  </style>
  <script id="chordography">
    function chordMaker(B,C){var H=function(g){g=g||{};var a=[],c={cellWidth:21,cellHeight:25,dotDia:19,nutHeight:5,fontBaseline:7,fontHeight:16,barGirth:2,barHeight:9,padding:5,minSpan:4},b,u,v,x,D,y,z,w,A,E,q,r,k,m,F,G,B=function(a){for(var d=(v-1)*k,h=w?1:0,e="";h<=x;h++)e+=" M"+f(q)+" "+f(r+h*m)+" h"+f(d);a.setAttributeNS(null,"d",e)},C=function(a){for(var d=f(x*m),h=0,e="";h<v;h++)e+=" M"+f(q+h*k)+" "+f(r)+" v"+d;a.setAttributeNS(null,"d",e)},H=function(a,d,h,e){for(var l=0,n=q;l<h.length;l++,n+=
    k)if(0<h[l]){var p=document.createElementNS("http://www.w3.org/2000/svg","circle"),t=f(r+(h[l]-(w?.5:b-.5))*m);p.cx.baseVal.value=n;p.cy.baseVal.value=t;p.r.baseVal.value=c.dotDia/2;a.appendChild(p);e&&e[l]&&(p=document.createElementNS("http://www.w3.org/2000/svg","tspan"),p.setAttributeNS(null,"x",f(n)),d.appendChild(p),p.setAttributeNS(null,"y",f(t+m/2-c.fontBaseline)),p.appendChild(document.createTextNode(e[l])))}},K=function(a){var d;d=(v-1)*k;var h=f(c.nutHeight/2);d="M"+f(q)+" "+f(r)+" h -"+
    h+" a"+h+" "+h+" 0 0 1 0 -"+2*h+" h"+f(d+2*h)+" a"+h+" "+h+" 0 0 1 0 "+2*h+" z";a.setAttributeNS(null,"d",d)},L=function(a,d,h,e){d=q+k*d;e=r+m*(e-(w?.5:b-.5));h=f(k*(h-1));var l=c.dotDia/2,n=f(h/2+l/2),p=c.barHeight,t=p+c.barGirth,g="M"+f(d-l)+" "+f(e-l),g=g+(" A "+n+" "+f(p)+" 0 0 1 "+f(d+h+l)+" "+f(e-l)),g=g+(" A "+n+" "+f(t)+" 0 0 0 "+f(d-l)+" "+f(e-l));a.setAttributeNS(null,"d",g)},I=function(a,d,h,e){a.setAttributeNS(null,"x",h);a.setAttributeNS(null,"y",e);a.appendChild(document.createTextNode(d))},
    J=function(a,d,h,e){e-=c.fontBaseline;for(var b=0;b<v;b++)if(d[b]){var n=document.createElementNS("http://www.w3.org/2000/svg","tspan");n.setAttributeNS(null,"x",f(h+b*k));n.setAttributeNS(null,"y",f(e));n.appendChild(document.createTextNode(d[b]));a.appendChild(n)}},M=function(a,b){for(var h in b)a.setAttribute(h,b[h])},f=function(a,b){return Number(a.toFixed(void 0!==b?b:1))};(function(a,b){for(var h in b)void 0!==a[h]&&(a[h]=b[h])})(c,g);return function(g,d){(function(a){var e,d,f,g=[],t=[],k=
    [];b=Number.MAX_VALUE;u=-b;a.head=[];v=a.fret.length;for(e=0;e<v;e++)f=a.fret[e],isNaN(f)||0>f?a.head[e]="x":0==f?a.head[e]="o":(a.head[e]="",d=t.indexOf(f),0>d?(g.push(e),t.push(f),f<b&&(b=f),f>u&&(u=f)):a.label[e]&&a.label[e]==a.label[g[d]]?k[d]=e:g[d]=e);b>u&&(b=1,u=c.minSpan);x=Math.max(c.minSpan,u-b+1);if(0<k.length)for(e=0,z=Number.MAX_VALUE;e<k.length;e++)k[e]&&z>t[e]&&(z=t[e],D=g[e],y=k[e]-D+1);else y=0;w=!(1<b&&u>x)})(d);k=c.cellWidth;q=c.padding+k/2+(w?0:k);m=c.cellHeight;G=c.padding+m*
    (d.title?1:0);F=G+m;r=F+c.nutHeight*(w?1:0);A=f(q+k*(v-.5)+c.padding);E=f(r+m*x+(d.footer?m:0)+c.padding);for(M(g,{"class":"chordChart",xmlns:"http://www.w3.org/2000/svg",width:f(A*(d.scale||1),0),height:f(E*(d.scale||1),0),viewBox:"0 0 "+f(A,0)+" "+f(E,0),preserveAspectRatio:"xMidYMid meet","font-size":c.fontHeight});0<g.childNodes.length;)g.removeChild(g.lastChild);(function(b){for(var e in b)for(var f=e,c=b[e].split(","),g=d.style,k=0;k<c.length;k++)a[c[k]]=document.createElementNS("http://www.w3.org/2000/svg",
    f),a[c[k]].className.baseVal=c[k],g&&g[c[k]]&&a[c[k]].setAttributeNS(null,"style",g[c[k]])})({g:"grid,dots,text",path:"frets,strings,nut,barre",text:"title,header,labels,lofret,footer"});d.style&&d.style.root&&g.setAttributeNS(null,"style",d.style.root);g.appendChild(a.grid);g.appendChild(a.dots);H(a.dots,a.labels,d.fret,d.label);g.appendChild(a.text);a.text.setAttributeNS(null,"text-anchor","middle");a.grid.appendChild(a.frets);B(a.frets);a.grid.appendChild(a.strings);C(a.strings);a.text.appendChild(a.header);
    J(a.header,d.head,q,F);w?(g.appendChild(a.nut),K(a.nut)):(a.text.appendChild(a.lofret),I(a.lofret,b,c.padding+k/2,r+m-c.fontBaseline));(void 0==d.barre||d.barre)&&1<y&&0<b&&(g.appendChild(a.barre),L(a.barre,D,y,z));d.footer&&(a.text.appendChild(a.footer),J(a.footer,d.footer,q,r+m*(x+1)));d.label&&a.text.appendChild(a.labels);d.title&&(a.text.appendChild(a.title),I(a.title,d.title,f(A/2),f(G)))}}(function(g,a){if(!g&&!a)return{};g=g||16;a=a||1.2;var c=function(a){return Number(a.toFixed(1))},b={fontHeight:g,
    dotDia:c(1.2*g)};1>a?(b.cellHeight=c(1.2*b.dotDia),b.padding=c(.2*b.cellHeight),b.cellWidth=c(b.cellHeight/a)):(b.cellWidth=c(1.2*b.dotDia),b.padding=c(.2*b.cellWidth),b.cellHeight=c(b.cellWidth*a));b.fontBaseline=c((b.cellHeight-.7*b.fontHeight)/2);b.nutHeight=c(.2*b.cellHeight);b.barHeight=c(.35*b.cellHeight);b.barGirth=c(.1*b.cellHeight);return b}(B,C));return function(g,a){var c={},b;for(b in a)c[b]=a[b];if(a.fret)for(c.fret=a.fret.split(","),b=0;b<c.fret.length;b++)c.fret[b]=parseInt(c.fret[b],
    10);a.label&&(c.label=a.label.split(","));a.footer&&(c.footer=a.footer.split(","));H(g,c)}};
  </script>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.6.0/katex.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.6.0/katex.min.js"></script>

  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/styles/atom-one-light.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/highlight.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/languages/julia.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/languages/haskell.min.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.13.1/lodash.min.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/mithril/0.2.5/mithril.min.js"></script>

  <style>
    div.annotated-code .code-box {
      display: flex;
    }
    div.annotated-code .code-box pre {
      flex: 1;
    }
    div.annotated-code .code-box pre:first-child {
      flex: 0;
      padding-top: 0.5em;
    }
    div.annotated-code .code-box pre:first-child span {
      padding: 0 3px;
    }
    div.annotated-code .code-box pre:first-child span:hover {
      background-color: black;
      color: white;
    }
  </style>
  <script>
  String.prototype.hashCode = function() {
    var hash = 0, i, chr, len;
    if (this.length === 0) return hash;
    for (i = 0, len = this.length; i < len; i++) {
      chr   = this.charCodeAt(i);
      hash  = ((hash << 5) - hash) + chr;
      hash |= 0; // Convert to 32bit integer
    }
    return hash;
  };

  var AnnotatedCode = {
    controller: function(props) {
      return {
        annotation: m.prop('')
      }
    },
    view: function(ctrl, props) {
      indexMap = Object.keys(props.annotations).map((i,e) => [i,e]).reduce(
        (acc,p) => {acc[p[0]] = p[1]; return acc;}, {});
      return (
        m('div.annotated-code',
          m('div.code-box',
           m('pre.hljs', {style: "overflow-x: visible; margin-bottom: 0, border-top-left-radius: 3px; border-bottom-left-radius: 3px; border-right: 1px dotted grey"},
           [...Array(props.code.split('\n').length).keys()].map((e) => {
             if (e in props.annotations) {
               return m('span.annotation',
                        {key: e, onmouseenter: ev => ctrl.annotation(props.annotations[e])},
                        indexMap[e] + '\n')
             } else {
               return '\n'
             }
           })),
           m('pre', m('code.python',
             {key: props.code.hashCode(),
              config: elem => hljs.highlightBlock(elem)},
             props.code))),
         ctrl.annotation().trim().length > 0 ? m('div.hljs', ctrl.annotation() ) : m('div') ));
    }
  }
  </script>

  <link rel="stylesheet" href="/css/app.css">
</head>
<body>
  <div id="container"></div>
  <script src="/js/app.js"></script>
</body>
</html>
